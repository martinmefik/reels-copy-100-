<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NewTok</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
:root {
  --accent:#ff2d55;
  --glass:rgba(255,255,255,.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family:Inter,sans-serif;
  overflow:hidden;
}
.hidden{display:none}

/* VIDEO */
#feed{height:100vh;position:relative}
.video{position:absolute;width:100%;height:100%;animation:fade .25s}
@keyframes fade{from{opacity:0;transform:scale(.98)}to{opacity:1}}
video{width:100%;height:100%;object-fit:cover}

/* OVERLAY */
.left{position:absolute;bottom:90px;left:16px}
.right{
  position:absolute;bottom:90px;right:16px;
  display:flex;flex-direction:column;gap:16px;align-items:center
}
.action{
  width:54px;height:54px;border-radius:50%;
  background:var(--glass);
  backdrop-filter:blur(12px);
  display:flex;align-items:center;justify-content:center;
  font-size:22px;
  transition:.2s;
}
.action:active{transform:scale(.9)}

/* HEART */
.heart{
  position:absolute;
  top:50%;left:50%;
  transform:translate(-50%,-50%) scale(0);
  font-size:90px;
  animation:heart .6s forwards;
}
@keyframes heart{
  0%{transform:translate(-50%,-50%) scale(0);opacity:0}
  50%{transform:translate(-50%,-50%) scale(1.4);opacity:1}
  100%{transform:translate(-50%,-50%) scale(1);opacity:0}
}

/* COMMENTS */
#comments{
  position:fixed;bottom:0;left:0;width:100%;height:65%;
  background:#111;
  border-radius:20px 20px 0 0;
  animation:up .3s;
  padding:16px;
}
@keyframes up{from{transform:translateY(100%)}to{transform:none}}
.comment{margin:8px 0;font-size:14px}
.comment b{color:#ff2d55}

/* NAV */
.nav{
  position:fixed;bottom:0;width:100%;
  display:flex;justify-content:space-around;
  background:rgba(0,0,0,.7);
  backdrop-filter:blur(10px);
  padding:12px
}
.nav button{background:none;color:white;border:none;font-size:14px}
</style>
</head>
<body>

<div id="auth">
  <input id="login" placeholder="–ù–∏–∫">
  <input id="pass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button onclick="login()">–í–æ–π—Ç–∏</button>
  <input id="rlogin" placeholder="–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è">
  <input id="rpass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button onclick="register()">–°–æ–∑–¥–∞—Ç—å</button>
</div>

<div id="feed" class="hidden"></div>

<div id="comments" class="hidden">
  <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
  <div id="commentList"></div>
  <input id="commentText" placeholder="–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π">
  <button onclick="sendComment()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
</div>

<div class="nav hidden" id="nav">
  <button onclick="upload()">Ôºã</button>
  <button onclick="logout()">–í—ã–π—Ç–∏</button>
</div>

<script>
let users=JSON.parse(localStorage.users||"{}");
let videos=JSON.parse(localStorage.videos||"[]");
let current=localStorage.current;
let idx=0,lastTap=0;

if(!users.martin_mefik){
  users.martin_mefik={p:"martin_mefik1234"};
  save();
}

function save(){
  localStorage.users=JSON.stringify(users);
  localStorage.videos=JSON.stringify(videos);
}

function login(){
  if(users[login.value]?.p===pass.value){
    current=login.value;
    localStorage.current=current;
    start();
  }else alert("–û—à–∏–±–∫–∞");
}

function register(){
  if(users[rlogin.value])return alert("–ó–∞–Ω—è—Ç–æ");
  users[rlogin.value]={p:rpass.value};
  save();alert("–û–∫");
}

function start(){
  auth.classList.add("hidden");
  feed.classList.remove("hidden");
  nav.classList.remove("hidden");
  show();
}

function show(){
  feed.innerHTML="";
  if(!videos[idx])idx=0;
  let v=videos[idx];
  if(!v)return;
  feed.innerHTML=`
  <div class="video">
    <video src="${v.src}" autoplay loop muted></video>
    <div class="left">@${v.user}</div>
    <div class="right">
      <div class="action" onclick="like()">‚ù§Ô∏è ${v.likes}</div>
      <div class="action" onclick="openComments()">üí¨</div>
    </div>
  </div>`;
}

feed?.addEventListener("touchend",e=>{
  let now=Date.now();
  if(now-lastTap<300){like(true)}
  lastTap=now;
});

function like(double=false){
  videos[idx].likes++;
  save();show();
  if(double){
    let h=document.createElement("div");
    h.className="heart";h.innerText="‚ù§Ô∏è";
    feed.appendChild(h);
    setTimeout(()=>h.remove(),600);
  }
}

let sy=0;
document.addEventListener("touchstart",e=>sy=e.touches[0].clientY);
document.addEventListener("touchend",e=>{
  if(sy-e.changedTouches[0].clientY>60){
    idx++;show();
  }
});

function upload(){
  let i=document.createElement("input");
  i.type="file";i.accept="video/*";
  i.onchange=e=>{
    videos.unshift({
      src:URL.createObjectURL(e.target.files[0]),
      user:current,
      likes:0,
      comments:[]
    });
    save();show();
  };
  i.click();
}

function openComments(){
  comments.classList.remove("hidden");
  renderComments();
}

function renderComments(){
  commentList.innerHTML="";
  videos[idx].comments.forEach(c=>{
    commentList.innerHTML+=`<div class="comment"><b>@${c.u}</b> ${c.t}</div>`;
  });
}

function sendComment(){
  videos[idx].comments.push({u:current,t:commentText.value});
  commentText.value="";
  save();renderComments();
}

function logout(){
  localStorage.removeItem("current");
  location.reload();
}

if(current)start();
</script>
</body>
</html>
